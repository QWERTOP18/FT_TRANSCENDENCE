{"openapi":"3.0.0","info":{"title":"トーナメントAPI","description":"\nトーナメント表を作成するためのAPI\n### インストール\n準備中。。。\n```\ndocker-compose up -d\n```\nで起動できるようにする予定。\n\n### 使用例\n1. [POST] `tournaments`でトーナメントを作成する。\n1. [POST] `participants`で参加者を追加する。\n1. [POST] `tournaments/:id/open`でトーナメントを開始する。\n1. [PUT] `participants/:id/ready`で参加者をreadyにする。\n1. [PUT] `participants/:id/cancel`で参加者をpendingにする。\n1. [PUT] `participants/:id/battle`で参加者をin_progressにする。\n1. [POST] `history`で対戦結果を保存する。\n1. 参加者が一人になるまで、4, 5, 6を繰り返す。\n1. 一人になると、自動で終了。\n\n### 共通エラー\n何かしらのエラーが発生した場合以下のエラーが発生する可能性があります。\n\n#### パラメータ\nエラーレスポンスでは以下のパラメータを必ず含みます。\n * statusCode : ステータスコード : number\n * code : エラーコード : string\n * error : statusCodeに基づくエラーメッセージ : string\n * message : 詳細なエラーメッセージ : string\n\n#### レスポンス例\n```\n{\n\t\"statusCode\":500,\n\t\"code\":\"TRT_ERR_NOT_IMPLEMENTED\",\n\t\"error\":\"Internal Server Error\",\n\t\"message\":\"This feature is not implemented.\"\n}\n```\n\n#### エラーコード一覧\n\n > 基本的なエラーコードは [Fastify](https://fastify.dev/docs/v5.3.x/Reference/Errors/) で定義されています。\n\n 以下はこのシステムで更に定義されているものです。\n\n | コード | 説明 | 解決法 |\n | --- | :---: | :---: |\n | TRT_ERR_NOT_IMPLEMENTED | この機能は実装されていません | 管理者に連絡してください |\n\n### ドキュメンテーションパス\n * `/documentation` : このページ\n * `/documentation/json` : このページを生成するための生のopenapi.json\n * `/documentation/yaml` : このページを生成するための生のopenapi.yaml\n\n","version":"0.0.0"},"components":{"schemas":{}},"paths":{"/tournaments":{"get":{"summary":"トーナメント一覧取得","tags":["tournament"],"description":"\n# 概要\nトーナメント一覧を取得します。\n\n# 注意点\n","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"array","items":{"description":"トーナメント","type":"object","properties":{"id":{"format":"uuid","description":"トーナメントID","type":"string"},"champion_id":{"format":"uuid","description":"優勝者の参加者ID","nullable":true,"type":"string"},"owner_id":{"format":"uuid","description":"トーナメントのオーナー参加者ID","type":"string"},"name":{"description":"トーナメント名","type":"string"},"max_num":{"description":"トーナメントの最大参加人数","minimum":2,"type":"number"},"description":{"description":"トーナメントの説明","type":"string"},"state":{"description":"トーナメントの状況 - reception: 受付中, open: 開催中, close: 終了","anyOf":[{"type":"string","enum":["reception"]},{"type":"string","enum":["open"]},{"type":"string","enum":["close"]}]},"participants":{"description":"参加者リスト","type":"array","items":{"format":"uuid","description":"参加者ID","type":"string"}},"histories":{"description":"トーナメントの履歴","type":"array","items":{"format":"uuid","description":"履歴ID","type":"string"}}},"required":["id","champion_id","owner_id","name","max_num","state","participants","histories"]}}}}}}},"post":{"summary":"トーナメント作成","tags":["tournament"],"description":"\n# 概要\nトーナメントを新規で作成します。\n\n# 注意点\n* 参加者の追加は別途、**参加者の作成**を行う必要があります。\n* マッチの追加はできません。参加者の数に応じて自動的にマッチが作成されます。＜＝この仕様は要相談。例えばオートマッチ機能を作成する？\n","requestBody":{"content":{"application/json":{"schema":{"type":"object","allOf":[{"description":"トーナメント","type":"object","properties":{"name":{"description":"トーナメント名","type":"string"},"description":{"description":"トーナメントの説明","type":"string"},"max_num":{"description":"トーナメントの最大参加人数","minimum":2,"type":"number"}},"required":["name","max_num"]},{"type":"object","properties":{"ownerExternalId":{"description":"トーナメントのオーナーの外部ID","type":"string"}},"required":["ownerExternalId"]}]}}}},"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"id":{"format":"uuid","description":"トーナメントID","type":"string"},"champion_id":{"format":"uuid","description":"優勝者の参加者ID","nullable":true,"type":"string"},"owner_id":{"format":"uuid","description":"トーナメントのオーナー参加者ID","type":"string"},"name":{"description":"トーナメント名","type":"string"},"max_num":{"description":"トーナメントの最大参加人数","minimum":2,"type":"number"},"description":{"description":"トーナメントの説明","type":"string"},"state":{"description":"トーナメントの状況 - reception: 受付中, open: 開催中, close: 終了","anyOf":[{"type":"string","enum":["reception"]},{"type":"string","enum":["open"]},{"type":"string","enum":["close"]}]},"participants":{"description":"参加者リスト","type":"array","items":{"format":"uuid","description":"参加者ID","type":"string"}},"histories":{"description":"トーナメントの履歴","type":"array","items":{"format":"uuid","description":"履歴ID","type":"string"}}},"required":["id","champion_id","owner_id","name","max_num","state","participants","histories"]}}}}}}},"/tournaments/{id}":{"get":{"summary":"トーナメント取得","tags":["tournament"],"description":"\n# 概要\n:idで指定されたトーナメントを取得します。\n\n# 注意点\n","parameters":[{"schema":{"format":"uuid","type":"string"},"in":"path","name":"id","required":true,"description":"トーナメントID"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"id":{"format":"uuid","description":"トーナメントID","type":"string"},"champion_id":{"format":"uuid","description":"優勝者の参加者ID","nullable":true,"type":"string"},"owner_id":{"format":"uuid","description":"トーナメントのオーナー参加者ID","type":"string"},"name":{"description":"トーナメント名","type":"string"},"max_num":{"description":"トーナメントの最大参加人数","minimum":2,"type":"number"},"description":{"description":"トーナメントの説明","type":"string"},"state":{"description":"トーナメントの状況 - reception: 受付中, open: 開催中, close: 終了","anyOf":[{"type":"string","enum":["reception"]},{"type":"string","enum":["open"]},{"type":"string","enum":["close"]}]},"participants":{"description":"参加者リスト","type":"array","items":{"format":"uuid","description":"参加者ID","type":"string"}},"histories":{"description":"トーナメントの履歴","type":"array","items":{"format":"uuid","description":"履歴ID","type":"string"}}},"required":["id","champion_id","owner_id","name","max_num","state","participants","histories"]}}}},"404":{"description":"見つからなかった","content":{"application/json":{"schema":{"description":"見つからなかった","type":"object","properties":{"code":{"description":"エラーコード","type":"string"},"statusCode":{"description":"ステータスコード","type":"number"},"error":{"description":"エラー概要","type":"string"},"message":{"description":"エラーメッセージ","type":"string"}},"required":["code","statusCode","error","message"]}}}}}}},"/tournaments/{id}/open":{"put":{"summary":"トーナメントを開始する","tags":["tournament"],"description":"\n# 概要\nトーナメントを開始します。\nstateをreceptionからopenに変更します。\n# 注意点\n* このトーナメントへの参加者が作成できなくなります。\n","parameters":[{"schema":{"format":"uuid","type":"string"},"in":"path","name":"id","required":true,"description":"トーナメントID"},{"schema":{"type":"string"},"in":"header","name":"X-External-Id","required":true,"description":"外部ID"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"ok":{"type":"boolean","enum":[true]}},"required":["ok"]}}}}}}},"/tournaments/{id}/participants":{"get":{"summary":"トーナメントの参加者を取得する","tags":["tournament"],"description":"\n# 概要\nトーナメントの参加者を取得します。\n\n# 注意点\n","parameters":[{"schema":{"format":"uuid","type":"string"},"in":"path","name":"id","required":true,"description":"トーナメントID"}],"responses":{"200":{"description":"トーナメント参加者","content":{"application/json":{"schema":{"description":"トーナメント参加者","type":"array","items":{"description":"参加者","type":"object","properties":{"id":{"format":"uuid","description":"参加者ID","type":"string"},"tournament_id":{"format":"uuid","description":"トーナメント ID","type":"string"},"external_id":{"description":"外部ID - トーナメントユーザーと外部のユーザー情報の紐付け用","type":"string"},"state":{"description":"参加者の状態 - pending: 参加待ち, ready: 準備完了, in_progress: 対戦中, battled: 対戦済み, eliminated: 敗退, champion: 優勝","anyOf":[{"type":"string","enum":["pending"]},{"type":"string","enum":["ready"]},{"type":"string","enum":["in_progress"]},{"type":"string","enum":["battled"]},{"type":"string","enum":["eliminated"]},{"type":"string","enum":["champion"]}]}},"required":["id","tournament_id","external_id","state"]}}}}}}},"post":{"summary":"参加者作成","tags":["participant"],"description":"\n# 概要\n参加者を作成します。\n\n# 注意点\n * トーナメントがreceptionの時のみ、参加者を作成できます。\n","requestBody":{"content":{"application/json":{"schema":{"description":"参加者","type":"object","properties":{"external_id":{"description":"外部ID - トーナメントユーザーと外部のユーザー情報の紐付け用","type":"string"}},"required":["external_id"]}}},"required":true,"description":"参加者"},"parameters":[{"schema":{"type":"string"},"in":"path","name":"id","required":true}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"id":{"format":"uuid","description":"参加者ID","type":"string"},"tournament_id":{"format":"uuid","description":"トーナメント ID","type":"string"},"external_id":{"description":"外部ID - トーナメントユーザーと外部のユーザー情報の紐付け用","type":"string"},"state":{"description":"参加者の状態 - pending: 参加待ち, ready: 準備完了, in_progress: 対戦中, battled: 対戦済み, eliminated: 敗退, champion: 優勝","anyOf":[{"type":"string","enum":["pending"]},{"type":"string","enum":["ready"]},{"type":"string","enum":["in_progress"]},{"type":"string","enum":["battled"]},{"type":"string","enum":["eliminated"]},{"type":"string","enum":["champion"]}]}},"required":["id","tournament_id","external_id","state"]}}}}}}},"/tournaments/{id}/histories":{"get":{"summary":"トーナメントの対戦結果を取得する","tags":["tournament"],"description":"\n# 概要\nトーナメントの対戦結果を取得します。\n\n# 注意点\n","parameters":[{"schema":{"format":"uuid","type":"string"},"in":"path","name":"id","required":true,"description":"トーナメントID"}],"responses":{"200":{"description":"トーナメントの対戦結果","content":{"application/json":{"schema":{"description":"トーナメントの対戦結果","type":"array","items":{"description":"トーナメントの履歴","type":"object","properties":{"id":{"format":"uuid","description":"履歴ID","type":"string"},"tournament_id":{"format":"uuid","description":"トーナメント ID","type":"string"},"winner":{"type":"object","properties":{"id":{"format":"uuid","description":"勝者の参加者ID","type":"string"},"score":{"minimum":0,"description":"スコア","type":"number"}},"required":["id","score"]},"loser":{"type":"object","properties":{"id":{"format":"uuid","description":"敗者の参加者ID","type":"string"},"score":{"minimum":0,"description":"スコア","type":"number"}},"required":["id","score"]},"created_at":{"description":"履歴の作成日時","format":"date-time","type":"string"}},"required":["id","tournament_id","winner","loser","created_at"]}}}}}}},"post":{"summary":"対戦結果作成","tags":["histories"],"description":"\n> 廃止予定です。 /tournaments/{id}/battle/end を使用してください。\n\n# 概要\n対戦結果を作成します。\n対戦結果を作成すると、各参加者は以下のステータスになります。\n\nloserのstateはeliminatedになります。\n\nwinnerのstateは、battledになります。\nただし、条件によっては、次の表のように変更されます。\n\n| 条件 | 次のstate |\n| --- | --- |\n| 自分以外の全参加者がeliminatedになった場合 | champion |\n| 全参加者のstateがeliminatedもしくはbattledになった場合 | battledの参加者はpendingになります。 |\n\npendingの参加者が奇数の場合はランダムで、一人だけstateがbattledになります。\n\nまた、championが決まった場合は、トーナメントのstateをcloseに変更します。\n\n# 注意点\n * close状態のトーナメントでは作成できません。\n","requestBody":{"content":{"application/json":{"schema":{"description":"トーナメントの履歴","type":"object","properties":{"winner":{"type":"object","properties":{"id":{"format":"uuid","description":"勝者の参加者ID","type":"string"},"score":{"minimum":0,"description":"スコア","type":"number"}},"required":["id","score"]},"loser":{"type":"object","properties":{"id":{"format":"uuid","description":"敗者の参加者ID","type":"string"},"score":{"minimum":0,"description":"スコア","type":"number"}},"required":["id","score"]}},"required":["winner","loser"]}}},"required":true,"description":"トーナメントの履歴"},"parameters":[{"schema":{"type":"string"},"in":"header","name":"X-Mediator-Token","required":true,"description":"調停者（スーパーユーザ）であることを示すトークン。"},{"schema":{"type":"string"},"in":"path","name":"id","required":true}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"id":{"format":"uuid","description":"履歴ID","type":"string"},"tournament_id":{"format":"uuid","description":"トーナメント ID","type":"string"},"winner":{"type":"object","properties":{"id":{"format":"uuid","description":"勝者の参加者ID","type":"string"},"score":{"minimum":0,"description":"スコア","type":"number"}},"required":["id","score"]},"loser":{"type":"object","properties":{"id":{"format":"uuid","description":"敗者の参加者ID","type":"string"},"score":{"minimum":0,"description":"スコア","type":"number"}},"required":["id","score"]},"created_at":{"description":"履歴の作成日時","format":"date-time","type":"string"}},"required":["id","tournament_id","winner","loser","created_at"]}}}}}}},"/tournaments/{tournament_id}/participants/{participant_id}/ready":{"put":{"summary":"参加者のステータスをreadyにする","tags":["participant"],"description":"\n# 概要\n参加者のステータスをreadyにします。\n\n# 権限\n *\n\n# 注意点\n * sateがpendingの時のみ可能です。\n * トーナメントがopenの時のみ可能です。\n","parameters":[{"schema":{"format":"uuid","type":"string"},"in":"path","name":"participant_id","required":true,"description":"参加者ID"},{"schema":{"format":"uuid","type":"string"},"in":"path","name":"tournament_id","required":true,"description":"ID"},{"schema":{"type":"string"},"in":"header","name":"X-External-Id","required":true,"description":"外部ID"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"ok":{"type":"boolean","enum":[true]}},"required":["ok"]}}}}}}},"/tournaments/{tournament_id}/participants/{participant_id}/cancel":{"put":{"summary":"参加者のステータスをpendingにする","tags":["participant"],"description":"\n# 概要\n参加者のステータスをpendingにします。\n\n# 注意点\n * stateがreadyの時のみ可能です。\n * トーナメントがopenの時のみ可能です。\n","parameters":[{"schema":{"format":"uuid","type":"string"},"in":"path","name":"participant_id","required":true,"description":"参加者ID"},{"schema":{"format":"uuid","type":"string"},"in":"path","name":"tournament_id","required":true,"description":"ID"},{"schema":{"type":"string"},"in":"header","name":"X-External-Id","required":true,"description":"外部ID"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"ok":{"type":"boolean","enum":[true]}},"required":["ok"]}}}}}}},"/tournaments/{id}/participants/battle":{"put":{"summary":"参加者のステータスをin_progressにする","tags":["participant"],"description":"\n> 廃止予定です。 /tournaments/{id}/battle/start を使用してください。\n\n# 概要\n複数の参加者のステータスをin_progressにします。\n参加者はready状態の2人指定する必要があります。\n\n# 注意点\n * stateがreadyの時のみ可能です。\n * トーナメントがopenの時のみ可能です。\n","requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"format":"uuid","description":"参加者ID","type":"string"}}}}},"parameters":[{"schema":{"format":"uuid","type":"string"},"in":"path","name":"id","required":true,"description":"ID"},{"schema":{"type":"string"},"in":"header","name":"X-Mediator-Token","required":true,"description":"調停者（スーパーユーザ）であることを示すトークン。"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"ok":{"type":"boolean","enum":[true]}},"required":["ok"]}}}}}}},"/tournaments/{id}/battle/start":{"put":{"summary":"参加者のステータスをin_progressにする","tags":["battle"],"description":"\n# 概要\n複数の参加者のステータスをin_progressにします。\n参加者はready状態の2人指定する必要があります。\n\n# 注意点\n * stateがreadyの時のみ可能です。\n * トーナメントがopenの時のみ可能です。\n","requestBody":{"content":{"application/json":{"schema":{"minItems":2,"maxItems":2,"type":"array","items":{"format":"uuid","description":"参加者ID","type":"string"}}}}},"parameters":[{"schema":{"format":"uuid","type":"string"},"in":"path","name":"id","required":true,"description":"ID"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"ok":{"type":"boolean","enum":[true]}},"required":["ok"]}}}}}}},"/tournaments/{id}/battle/end":{"post":{"summary":"対戦終了","tags":["battle"],"description":"\n# 概要\n対戦結果を作成します。\n対戦結果を作成すると、各参加者は以下のステータスになります。\n\nloserのstateはeliminatedになります。\n\nwinnerのstateは、battledになります。\nただし、条件によっては、次の表のように変更されます。\n\n| 条件 | 次のstate |\n| --- | --- |\n| 自分以外の全参加者がeliminatedになった場合 | champion |\n| 全参加者のstateがeliminatedもしくはbattledになった場合 | battledの参加者はpendingになります。 |\n\npendingの参加者が奇数の場合はランダムで、一人だけstateがbattledになります。\n\nまた、championが決まった場合は、トーナメントのstateをcloseに変更します。\n\n# 注意点\n * close状態のトーナメントでは作成できません。\n","requestBody":{"content":{"application/json":{"schema":{"description":"トーナメントの履歴","type":"object","properties":{"winner":{"type":"object","properties":{"id":{"format":"uuid","description":"勝者の参加者ID","type":"string"},"score":{"minimum":0,"description":"スコア","type":"number"}},"required":["id","score"]},"loser":{"type":"object","properties":{"id":{"format":"uuid","description":"敗者の参加者ID","type":"string"},"score":{"minimum":0,"description":"スコア","type":"number"}},"required":["id","score"]}},"required":["winner","loser"]}}},"required":true,"description":"トーナメントの履歴"},"parameters":[{"schema":{"type":"string"},"in":"path","name":"id","required":true}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"ok":{"type":"boolean","enum":[true]}},"required":["ok"]}}}}}}},"/tournaments/{id}/battle/cancel":{"put":{"summary":"対戦を取り消す","tags":["battle"],"description":"\n# 概要\nin_progressのユーザー2名を in_progress に戻す。\n\n# 注意点\n * close状態のトーナメントでは使用できません。\n * /tournaments/{id}/battle/start で使用した参加者IDの組み合わせでなくても動作します。\n\n","requestBody":{"content":{"application/json":{"schema":{"minItems":2,"maxItems":2,"type":"array","items":{"format":"uuid","description":"参加者ID","type":"string"}}}}},"parameters":[{"schema":{"type":"string"},"in":"path","name":"id","required":true}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"description":"OK","type":"object","properties":{"ok":{"type":"boolean","enum":[true]}},"required":["ok"]}}}}}}}},"tags":[{"name":"tournament","description":"トーナメントに関するAPI"},{"name":"histories","description":"対戦結果に関するAPI"},{"name":"participant","description":"参加者に関するAPI"}]}